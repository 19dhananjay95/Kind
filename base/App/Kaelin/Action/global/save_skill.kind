App.Kaelin.Action.global.save_skill(
  user: String,
  target_pos: App.Kaelin.Coord,
  key: U16,
  global: App.Kaelin.State.global
): App.Kaelin.State.global
  stage = global@stage
  let new_stage = case stage {
    planning:
      App.Kaelin.Stage.planning(stage.local_tick, stage.seconds, stage.round, List.cons!({user, target_pos, key}, stage.skills_list))
  } default stage
  global@stage <- new_stage