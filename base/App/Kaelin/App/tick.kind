// TODO turns here?
App.Kaelin.App.tick: App.Tick<App.Kaelin.State>
  (tick, glob)
    glob = glob@tick <- U64.add(glob@tick, 1)
    stage = glob@stage
    case stage {
      init: glob@stage <- App.Kaelin.Stage.draft
      draft: glob@stage <- App.Kaelin.Stage.planning(0, 0, 1, [])
      planning: 
        stage_seconds = (20#64 - (stage.local_tick / 16)) - 1
        ticks_round = 20#64 * 16
        if U64.gte(stage.local_tick, ticks_round) then 
          glob@stage <- App.Kaelin.Stage.action(stage.round, List.reverse!(stage.skills_list))
        else 
          glob@stage <- App.Kaelin.Stage.planning(stage.local_tick + 1, stage_seconds, stage.round, stage.skills_list)
      action:
        let glob = execute_skills!(stage.skills_list, glob)
        App.Kaelin.Stage.action.end(glob)
    } default glob


execute_skills<S: App.State>(skills : List<App.Kaelin.State.cast_info>, glob: App.Kaelin.State.global): App.Kaelin.State.global
  case skills {
    nil:  
      glob
    cons:
      let new_glob = App.Kaelin.Skill.skill_use(skills.head@player, skills.head@target_pos, skills.head@key, glob)
      execute_skills!(skills.tail, new_glob)
  }