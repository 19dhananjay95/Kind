// App states (local = clicks, global = visitors)
App.CardPlayer.State: App.State
  App.State.new(Nat, Nat)

// Initial state
App.CardPlayer.init: App.Init<App.CardPlayer.State>
  App.Store.new<App.CardPlayer.State>(0, 0)

// Render function
App.CardPlayer.draw: App.Draw<App.CardPlayer.State>
  (state)
    <div style={"margin": "0", "height": "100%", "width": "100%", "background-image": "url(https://i.imgur.com/H5BB1V3.png)"}>
      <div style={"height": "100%", "width": "100%", "display": "flex", "flex-direction": "column", "justify-content": "center"}>
        <header style={"background-image": "url(https://i.imgur.com/duRFrIR.png)", "width": "100%", "height": "64px"}></header>
        <div style={"display": "flex", "width": "100%", "justify-content": "center", "align-items": "center", "flex": "1"}>
          // { App.CardPlayer.card.user("FLINA", "HEALER", "https://i.imgur.com/T49eUdC.png") }
          // { App.CardPlayer.card.others("CRONI", "MAGE", "https://i.imgur.com/1FZbfvI.png") }
          // { App.CardPlayer.card.others("ZOIO", "SENTINEL", "https://i.imgur.com/T49eUdC.png") }
          <div style={"max-height": "416px", "width": "148px", "display": "flex", "flex-wrap": "wrap"}>
            for card in [App.CardPlayer.card.hero(hero) for hero in App.KL.Game.Hero.list]:
              card     
          </div>
        </div>
        <footer style={"display": "flex", "padding": "5px"}>
          <div style={"flex": "1"}></div>
          <div><img src=App.CardPlayer.footer.ready_button></img></div>
          <div style={"flex": "1"}></div>
        </footer>
      </div>
    </div>

App.CardPlayer.card.hero(hero: App.KL.Game.Hero): DOM
  let fator = 2
  let bt = 2

  let portrait = hero@picture(true, 0)
  let inner =
    <div style={"width": "100%"}>
      <img style={"width": "100%"} src=portrait></img>
    </div>

  App.CardPlayer.card.wrapper(44, 74, bt, fator, App.CardPlayer.card.hero.portrait, inner)

App.CardPlayer.card.hero.portrait: String
  "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAABKCAYAAADAKbZGAAAAcUlEQVR42u3bwQkAIQwEQNu4GuTasSPrVvwdeE+FBGZhyXcK2JSSNfVp4609ZJftF7tuxG7oyNgvGhgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgY+Dg43QY+3ZeBXMwEjZrO46oJAlgAAAAASUVORK5CYII="

App.CardPlayer.footer.ready_button: String
  "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAAAqCAYAAABr9d/aAAAC70lEQVR42u2aMWsVQRDH0/kBbNKksElhSBU0giJIAgkBFYsINgmKjdilUWzsEhQUIailYqG1FsHGxlQ2+gkEG3sLwULkZA7mmN03uzf79m7fu+S/8Oe9nZ27t29+N7N7793MDBoaWndt+eW3ClEAdbRBMgPII5psAIvKiDZGe/q7qsochDY5oJymSNfhlEiHGXdCmUfjsQ8C+PKgmVVjj0Eg51RIgJoek9QkcWwMCevf9JVPLfscVtxhWUoqwp+3EbHGVrIJspIGOSA/RCujltLK6+dxhK59dz9JJJQQOPb3bQ1YzQgNRzXAs6uPoQHKAchEz338UUuWABaP4crvRymxVwEC3nAgOgAXF3abtKT3pLn5nVrcX156BRVUiIPk1AA8eWo7Cg8QJwMvBpGYqQBD8ABxMvA0iFkAu4a4sfW+uvX8S1A0nuJ35c5Blt/1B5+qiytvax96pb60+7YS8DoH2KXaNkY0fn7thclv/fa7Vr/t/c+tfuSzcuN1de3eB8dOfd9WKk5TDTDWaJzmZvWj75Pj9+fvvwYiif1CNgAUYOSVHQOoZc2jw+8jYGLns/gBYCJADVbMFvp1wnJsG1QABECUUN6ctJXQzYcHKkBrCbUAlOeTfQCMbE5kpsX8KNAaQOsmJmSjHSfvVv3GFxcAdpCBIYB+xqQCPHPhmQqR50VjAOitTwTDsgbyesT3bKE10C+DKQB5jnzfKMfIVipGJoAnZi/VA0dxE5MLUJtnSXgSIM2TWDkASWQklc7CcQDKv12kcmCRvv78NZUAJQ/m5DxbM0mI4wDM3ZxYNzvTALAVnv/AjQaxT/mBWbr8pNUWCvjq3TcjsCw2bXdJ62psniViY4YXg7g+t9OrKFBcwui9xaaJxjfm748ca7H52ry6b5pnCZnhhSDSSW6e3nNUavLHTVqck+ClQIT61djwYuUUKqcseCGIfK/IT0nh2cxuJOMpY50Fz4dIN44sQOwHnoxxJ/B8iFDhx+YN7T9DLCkhPaM0KwAAAABJRU5ErkJggg=="

// App.CardPlayer.card.user(name: String, type: String, img: String): DOM
//   let fator = 2
//   let bt    = 2
//   let inner = 
//     <div style={"display": "contents"}>
//       <div style={"height": "40%", "width": "17%", "max-height": "40%", "overflow": "auto", "border-radius": "5px 0px 0px 5px"}>
//         for i in [0 to 50]:
//           <div style={
//             "background-image": "url("|App.CardPlayer.card.button|")"
//             "background-size": "100% 100%"
//             "height": "20%"
//             "width": "100%"
//             // "font-size": "1.5rem"
//             "border-radius": "5px"
//             "display": "flex"
//             "align-items": "center"
//             "justify-content": "center"
//             "color": "white"
//           }>
//             Nat.show(i)
//           </div>
//       </div>
//       <div style={"width": "82%", "border-radius": "0 5px 5px 0", "padding": Nat.show(fator * bt) | "px"}>
//         {App.CardPlayer.card.hero(name, type, img)}
//       </div>
//     </div>
  
//   App.CardPlayer.card.wrapper(99, 208, bt, fator, "https://i.imgur.com/HTnAVKj.png", inner)

// App.CardPlayer.card.others(name: String, type: String, img: String): DOM
//   let fator = 2
//   let bt    = 2
//   let inner = 
//     <div style={"width": "100%", "border-radius": "0 5px 5px 0", "padding": Nat.show(fator * bt) | "px"}>
//       {App.CardPlayer.card.hero(name, type, img)}
//     </div>
  
//   App.CardPlayer.card.wrapper(82, 208, bt, fator, "https://i.imgur.com/CI2xJrU.png", inner)

// // https://i.imgur.com/HTnAVKj.png
App.CardPlayer.card.wrapper(width: Nat, height: Nat, bt: Nat, fator: Nat, background: String, inner: DOM): DOM
  <div style={
    "height": Nat.show(fator * height) | "px", 
    "width": Nat.show(fator * width) | "px", 
    "display": "flex", 
    "background-image": "url("|background|")", 
    "background-size": "100% 100%", 
    "padding-top": Nat.show(fator * bt) | "px"
    "margin": "0 10px"
  }>
    {inner}
  </div>

// App.CardPlayer.card.hero(name: String, type: String, img: String): DOM
//   <div style={"height": "100%"}>
//     <div style={
//       "height": "52%"
//     }>
//       {App.CardPlayer.card.img(name, type, img)}
//     </div>
//     <div style={"height": "48%", "width": "100%"}>
//       {App.CardPlayer.card.stats}
//     </div>
//   </div>

// // https://i.imgur.com/T49eUdC.png
// App.CardPlayer.card.img(name: String, type: String, img: String): DOM
//   <div style={"position": "relative", "height": "100%"}> 
//     <div style={
//       "position": "absolute", 
//       "margin-left": "auto"
//       "margin-right": "auto"
//       "left": "0"
//       "right": "0"
//       "text-align": "center"
//       "top": "-7%"
//       "width": "55%",
//       "height": "55%",
//       "background-image": "url("|img|")",
//       "background-size": "contain",
//       "background-position": "center",
//       "background-repeat": "no-repeat"
//     }>
//       // <img src=img style={"object-size": "contain"}></img>
//     </div>
//     <div style={
//       "position": "absolute"
//       "top": "70%"
//       "left": "0"
//       "right": "0"
//       "margin": "auto"
//       "height": "25%"
//       "display": "flex"
//       "flex-direction": "column"
//       "justify-content": "space-between"
//       "align-items": "center"
//     }>
//       <span style={"color": "white"}>name</span>
//       <img src=App.CardPlayer.card.name_divisor></img>
//       <span style={"color": "white"}>type</span>
//     </div>
//   </div>

// App.CardPlayer.card.stats: DOM
//   <div style={"display": "contents"}> 
//     for icon in App.CardPlayer.card.attr_icons:
//       let {i, img} = icon
//       <div style={"display": "contents"}>
//         <div style={
//           "height": "15%",
//           "display": "flex", 
//           "align-items": "center", 
//           "padding": "4% 10%",
//           "margin-top": if i =? 2 then "4%" else ""
//         }>
//           <div style={
//             "flex": "1"
//             "margin-right": "10%"
//             "height": "100%"
//           }>
//             <img style={"width": "100%", "height": "100%", "object-fit": "contain"} src=img></img>
//           </div>
//           <div style={"display": "flex", "height": "100%", "flex": "4", "align-items": "center"}>
//             for j in [1 to 6]:
//               let bar = App.CardPlayer.card.attr_bar(i, j)
//               <div style={"margin": "0 3px", "display": "flex", "align-items": "center", "flex": "1"}><img style={"width": "100%"} src=bar></img> </div>
//           </div>
//         </div>
//         {
//           if i =? 4 then <span></span>
//           else 
//             <div style={"display": "flex", "justify-content": "center"}>
//               <img style={"width": "80%", "margin": "auto"} src=App.CardPlayer.card.divisor></img>
//             </div>
//         }
//       </div>
//   </div>

App.CardPlayer.card.button: String
  "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAPCAYAAADtc08vAAAAsUlEQVR42mNgAAIzl67/5tPP/7fY8QCM+778x4ph8iC1ID0MpGjGaYiudhuKAIhvbjwfKwbJIVsorBj/nwFEwDTLqhXh1AzDIDUwQ+AGwDSDMMgWfBimDqQHxQCYJDEGwLwySA0gZAhOA9glHOEYZhA6RlaDYQCyAg/ZIqwY2QKsXjCRSARjXAbA5DG8ABOAGZKo1Y4VI2sG0XADkA2BSWLDyPIwfeAMBeMgBxI+jKwZAA9Tzqish/WQAAAAAElFTkSuQmCC"

App.CardPlayer.card.divisor: String
  "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAACCAYAAADsDAqEAAAAGUlEQVR42mNgl3D8P4od/zM4qOX/H8X5/wFLCtMnRwvN3AAAAABJRU5ErkJggg=="

App.CardPlayer.card.name_divisor: String
  "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAABCAYAAAChQ5zUAAAAKklEQVR42mPQlgz7z82j9R9Eg7CZSxcGjYzbZT/AaWpgZDORMTa3ILsVAD4KYiEWiGpBAAAAAElFTkSuQmCC"

App.CardPlayer.card.attr_bar(i: Nat, j: Nat): String
  case Nat.cmp(j, i) {
    ltn: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAADCAYAAABBCiV2AAAAGElEQVR42mN4nf3/PyHMQJSiyRmv/hPCACSbVe0aeuODAAAAAElFTkSuQmCC"
    eql: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAADCAYAAABBCiV2AAAAGElEQVR42mPo+/L/PyHMQJSiyRmv/hPCAAScWQUsjAs3AAAAAElFTkSuQmCC"
    gtn: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAADCAYAAABBCiV2AAAAGElEQVR42mPg5tH6TwgzEKXIzKXrPyEMAKotKJyhzZc5AAAAAElFTkSuQmCC"
  }

App.CardPlayer.card.attr_icons: List<Pair<Nat, String>>
  [
    {2, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAATUlEQVR42mNgAIK+L///W+x48J8BCwCJg+QxBNA14BKHS8BMgbFx2ciArhDFelwaCCpEVoRuA0ETcdqA7DlsiuGexBk82IIPb/CgaQAAVVyucYmp1skAAAAASUVORK5CYII="}, // offensive
    {0, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAALCAYAAACtWacbAAAAQ0lEQVR42mNgQAIWOx787/vy/z+IZkAHMEl0DFeMLoFVjChFMKsYsACcVmLjYzgcWRGGL7H5jmAwYA0rgoGJrhBdDABa1bsEjscb1AAAAABJRU5ErkJggg=="}, // defensive
    {3, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAKCAYAAABv7tTEAAAAQklEQVR42mOw2PHgf9+X/ygYmxgDOgApgmF0xTg1wTTisgWnJnTN6M7Fq4lkDVSxBT00sRqASxNBm/EFO9khCRIHABDzAc+vGvQQAAAAAElFTkSuQmCC"}, // speed
    {1, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAQElEQVR42mNggAKLHQ/+9335j4JBYgzIAKsgkmY4B6YI3UQUeZgAuqnIpoFpFA6Sqehi5CnEazXRniE6eIgNcADtwMQtWOgT0gAAAABJRU5ErkJggg=="}, // accuracy
    {4, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAMCAYAAACwXJejAAAAU0lEQVR42mNgQAIWOx787/vy/z+IZsAGQJLoGEMRzBSYBrymIdM4rYOZiKEQm/HI1qNysJgO1ozuI2QT4dZicwtGUCAHIDpGMRmXKRhhhc0kmBwAbSTOuAXc0NYAAAAASUVORK5CYII="} // utility
  ]

// Event handler
App.CardPlayer.when: App.When<App.CardPlayer.State>
  (event, state)
  App.pass!

// Global ticker: not used
App.CardPlayer.tick: App.Tick<App.CardPlayer.State>
  App.no_tick<App.CardPlayer.State>

// Global visitor: counts posts to room_zero
App.CardPlayer.post: App.Post<App.CardPlayer.State>
  (time, room, addr, data, global_state)
  global_state + 1

// A "CardPlayer, world!" + counter application
App.CardPlayer: App<App.CardPlayer.State>
  App.new<App.CardPlayer.State>(
    App.CardPlayer.init
    App.CardPlayer.draw
    App.CardPlayer.when
    App.CardPlayer.tick
    App.CardPlayer.post
  )
